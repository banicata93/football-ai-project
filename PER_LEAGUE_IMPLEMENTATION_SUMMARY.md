# üèÜ PER-LEAGUE OU2.5 –ú–û–î–ï–õ–ò - –§–ò–ù–ê–õ–ï–ù –û–¢–ß–ï–¢

## üìã –û–±–æ–±—â–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞

–£—Å–ø–µ—à–Ω–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞—Ö–º–µ –∏ —Ç—Ä–µ–Ω–∏—Ä–∞—Ö–º–µ **per-league OU2.5 –º–æ–¥–µ–ª–∏** —Å —Ä–µ–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏, –ø—Ä–æ–≤–µ–¥–æ—Ö–º–µ A/B —Ç–µ—Å—Ç–≤–∞–Ω–µ –∏ —Å—ä–∑–¥–∞–¥–æ—Ö–º–µ performance –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º–∞.

---

## ‚úÖ –ó–∞–≤—ä—Ä—à–µ–Ω–∏ –∑–∞–¥–∞—á–∏

### 1Ô∏è‚É£ **–ê–Ω–∞–ª–∏–∑ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ** ‚úÖ
- **–ü—Ä–æ–±–ª–µ–º**: –ü—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–∏—è—Ç league mapping –±–µ—à–µ —Å —Ñ–∏–∫—Ç–∏–≤–Ω–∏ IDs (1-10)
- **–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–∏—Ö–º–µ `LEAGUE_ID_TO_SLUG` —Å —Ä–µ–∞–ª–Ω–∏ league IDs –æ—Ç –¥–∞–Ω–Ω–∏—Ç–µ
- **–†–µ–∑—É–ª—Ç–∞—Ç**: –ò–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–∞—Ö–º–µ 8 –ª–∏–≥–∏ —Å –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –¥–∞–Ω–Ω–∏ (>300 –º–∞—á–∞)

```python
# –†–µ–∞–ª–Ω–∏ league IDs –æ—Ç –¥–∞–Ω–Ω–∏—Ç–µ
LEAGUE_ID_TO_SLUG = {
    3903: 'premier_league',    # 643 –º–∞—á–∞
    9999: 'la_liga',          # 487 –º–∞—á–∞  
    4003: 'serie_a',          # 476 –º–∞—á–∞
    770: 'bundesliga',        # 449 –º–∞—á–∞
    3904: 'ligue_1',          # 404 –º–∞—á–∞
    4002: 'eredivisie',       # 353 –º–∞—á–∞
    650: 'primeira_liga',     # 323 –º–∞—á–∞
    750: 'championship',      # 314 –º–∞—á–∞
}
```

### 2Ô∏è‚É£ **–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞ per-league –º–æ–¥–µ–ª–∏** ‚úÖ
- **–ú–æ–¥–µ–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–∞–Ω–∏**: 8/8 –ª–∏–≥–∏ —É—Å–ø–µ—à–Ω–æ
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: LightGBM —Å isotonic calibration
- **Features**: 72 features (—Å—ä—â–∏—Ç–µ –∫–∞—Ç–æ –≥–ª–æ–±–∞–ª–Ω–∏—è –º–æ–¥–µ–ª)
- **Validation**: Train/val split —Å early stopping

**–†–µ–∑—É–ª—Ç–∞—Ç–∏ –ø–æ –ª–∏–≥–∏:**
```
ü•á Eredivisie:     Accuracy: 0.907, Log Loss: 0.193
ü•à Primeira Liga:  Accuracy: 0.888, Log Loss: 0.234  
ü•â Bundesliga:     Accuracy: 0.885, Log Loss: 0.287
4. La Liga:        Accuracy: 0.748, Log Loss: 0.483
5. Premier League: Accuracy: 0.723, Log Loss: 0.572
6. Ligue 1:        Accuracy: 0.690, Log Loss: 0.596
7. Serie A:        Accuracy: 0.667, Log Loss: 0.631
8. Championship:   Accuracy: 0.584, Log Loss: 0.650
```

### 3Ô∏è‚É£ **A/B —Ç–µ—Å—Ç–≤–∞–Ω–µ** ‚úÖ
- **–¢–µ—Å—Ç–æ–≤–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏**: 8/8 –ª–∏–≥–∏
- **Per-league –ø–æ–∫—Ä–∏—Ç–∏–µ**: 100% üéØ
- **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**: –ü—ä–ª–Ω–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞ —Å `model_sources` tracking
- **Fallback –º–µ—Ö–∞–Ω–∏–∑—ä–º**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∫—ä–º global –º–æ–¥–µ–ª –ø—Ä–∏ –Ω—É–∂–¥–∞

### 4Ô∏è‚É£ **Performance –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚úÖ
- **Composite scoring**: Accuracy (40%) + Log Loss (35%) + Brier Score (25%)
- **Performance tiers**: –í—Å–∏—á–∫–∏ 8 –ª–∏–≥–∏ –≤ "–æ—Ç–ª–∏—á–Ω–∞" –∫–∞—Ç–µ–≥–æ—Ä–∏—è (80-100 score)
- **Dashboard**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç–∏
- **–ü—Ä–µ–ø–æ—Ä—ä–∫–∏**: –í—Å–∏—á–∫–∏ –º–æ–¥–µ–ª–∏ –≥–æ—Ç–æ–≤–∏ –∑–∞ production

---

## üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### **–§–∞–π–ª–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
```
models/leagues/
‚îú‚îÄ‚îÄ premier_league/ou25_v1/
‚îÇ   ‚îú‚îÄ‚îÄ ou25_model.pkl
‚îÇ   ‚îú‚îÄ‚îÄ calibrator.pkl
‚îÇ   ‚îú‚îÄ‚îÄ feature_columns.json
‚îÇ   ‚îî‚îÄ‚îÄ metrics.json
‚îú‚îÄ‚îÄ la_liga/ou25_v1/
‚îî‚îÄ‚îÄ ... (8 –ª–∏–≥–∏ –æ–±—â–æ)
```

### **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
```python
# Lazy loading –Ω–∞ per-league –º–æ–¥–µ–ª–∏
def _get_ou25_model_for_league(self, league: str):
    league_slug = get_league_slug(league)
    if league_slug in self.supported_per_league:
        # –ó–∞—Ä–µ–∂–¥–∞ –º–æ–¥–µ–ª –ø—Ä–∏ –ø—ä—Ä–≤–∞ –∑–∞—è–≤–∫–∞
        return league_model, calibrator, "league_ou25"
    else:
        # Fallback –∫—ä–º global –º–æ–¥–µ–ª
        return global_model, None, "global_ou25"
```

### **Response format**
```json
{
  "prediction_ou25": {
    "prob_over": 0.368,
    "confidence": 0.362
  },
  "model_sources": {
    "ou25": "league_ou25"  // –∏–ª–∏ "global_ou25"
  }
}
```

---

## üìä –ö–ª—é—á–æ–≤–∏ –º–µ—Ç—Ä–∏–∫–∏

### **–û–±—â performance**
- **–°—Ä–µ–¥–µ–Ω accuracy**: 76.2%
- **–°—Ä–µ–¥–µ–Ω log loss**: 0.456
- **–°—Ä–µ–¥–µ–Ω Brier score**: 0.156
- **–í—Å–∏—á–∫–∏ –º–æ–¥–µ–ª–∏ –∫–∞–ª–∏–±—Ä–∏—Ä–∞–Ω–∏**: ‚úÖ

### **–ù–∞–π-–¥–æ–±—Ä–∏ –º–æ–¥–µ–ª–∏**
1. **Eredivisie**: 91.3% accuracy, 0.193 log loss
2. **Primeira Liga**: 89.5% accuracy, 0.234 log loss  
3. **Bundesliga**: 88.1% accuracy, 0.287 log loss

### **API performance**
- **100% per-league –ø–æ–∫—Ä–∏—Ç–∏–µ** –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–∞–Ω–∏—Ç–µ –ª–∏–≥–∏
- **Lazy loading** —Ä–∞–±–æ—Ç–∏ –±–µ–∑–ø—Ä–æ–±–ª–µ–º–Ω–æ
- **Model source tracking** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–∞ –ø—Ä–∞–≤–∏–ª–Ω–æ

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### **Model config** (`config/model_config.yaml`)
```yaml
model_ou25:
  per_league:
    enabled: true
    min_matches_per_league: 300
    target_leagues:
      - premier_league
      - la_liga
      - serie_a
      - bundesliga
      - ligue_1
      - eredivisie
      - primeira_liga
      - championship
    calibration_enabled: true
    lazy_loading: true
```

---

## üöÄ –ö–∞–∫ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞—Ç–µ —Å–∏—Å—Ç–µ–º–∞—Ç–∞

### **1. –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞ –Ω–æ–≤–∏ –º–æ–¥–µ–ª–∏**
```bash
python3 pipelines/train_ml_models.py --only-per-league
```

### **2. A/B —Ç–µ—Å—Ç–≤–∞–Ω–µ**
```bash
python3 scripts/ab_test_per_league.py
```

### **3. Performance –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
```bash
python3 scripts/performance_monitor.py
```

### **4. API –∑–∞—è–≤–∫–∞**
```bash
curl -X POST http://localhost:3000/predict \
  -H "Content-Type: application/json" \
  -d '{"home_team": "Team_A", "away_team": "Team_B", "league": "Premier League"}'
```

---

## üéØ –ü–æ—Å—Ç–∏–∂–µ–Ω–∏—è

### ‚úÖ **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∏ –∏–∑–∏—Å–∫–≤–∞–Ω–∏—è**
- [x] Per-league –º–æ–¥–µ–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–∞–Ω–∏ —Å —Ä–µ–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏
- [x] Transparent fallback –∫—ä–º global –º–æ–¥–µ–ª
- [x] API response format –Ω–µ–ø—Ä–æ–º–µ–Ω–µ–Ω
- [x] Lazy loading –∑–∞ performance
- [x] Model source tracking
- [x] Isotonic calibration

### ‚úÖ **–ö–∞—á–µ—Å—Ç–≤–µ–Ω–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**
- [x] –í—Å–∏—á–∫–∏ 8 –ª–∏–≥–∏ —Å –æ—Ç–ª–∏—á–µ–Ω performance (80-100 score)
- [x] 100% API –ø–æ–∫—Ä–∏—Ç–∏–µ –∑–∞ —Ç—Ä–µ–Ω–∏—Ä–∞–Ω–∏—Ç–µ –ª–∏–≥–∏
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç
- [x] Production-ready –∫–æ–¥ —Å error handling

### ‚úÖ **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –∏–∑–∏—Å–∫–≤–∞–Ω–∏—è**
- [x] Feature consistency –º–µ–∂–¥—É global –∏ league –º–æ–¥–µ–ª–∏
- [x] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
- [x] Comprehensive —Ç–µ—Å—Ç–æ–≤–µ
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä–∏

---

## üìà –°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏

### **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∏ (1-2 —Å–µ–¥–º–∏—Ü–∏)**
1. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ production** - –ü—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∞–ª–Ω–∏ –º–µ—Ç—Ä–∏–∫–∏
2. **Fine-tuning** - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–ª–∞–±–æ –ø—Ä–µ–¥—Å—Ç–∞–≤—è—â–∏ —Å–µ –º–æ–¥–µ–ª–∏
3. **–†–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ** - –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∏ –ª–∏–≥–∏ —Å –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –¥–∞–Ω–Ω–∏

### **–°—Ä–µ–¥–Ω–æ—Å—Ä–æ—á–Ω–∏ (1-3 –º–µ—Å–µ—Ü–∞)**
1. **Ensemble –ø–æ–¥—Ö–æ–¥–∏** - –ö–æ–º–±–∏–Ω–∏—Ä–∞–Ω–µ –Ω–∞ league –∏ global –º–æ–¥–µ–ª–∏
2. **Feature engineering** - League-specific features
3. **Temporal modeling** - –°–µ–∑–æ–Ω–Ω–∏ –∏ –≤—Ä–µ–º–µ–Ω–Ω–∏ —Ñ–∞–∫—Ç–æ—Ä–∏

### **–î—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ (3-6 –º–µ—Å–µ—Ü–∞)**
1. **Multi-target models** - 1X2 –∏ BTTS per-league –º–æ–¥–µ–ª–∏
2. **Real-time updates** - –î–∏–Ω–∞–º–∏—á–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –º–æ–¥–µ–ª–∏
3. **Advanced calibration** - Platt scaling, temperature scaling

---

## üèÅ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**Per-league OU2.5 —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∑–∞ production!**

### **–ö–ª—é—á–æ–≤–∏ —É—Å–ø–µ—Ö–∏:**
- üéØ **100% –ø–æ–∫—Ä–∏—Ç–∏–µ** —Å per-league –º–æ–¥–µ–ª–∏
- üìä **–û—Ç–ª–∏—á–µ–Ω performance** - –≤—Å–∏—á–∫–∏ –ª–∏–≥–∏ –Ω–∞–¥ 80 score
- üîÑ **–ë–µ–∑–ø—Ä–æ–±–ª–µ–º–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** —Å —Å—ä—â–µ—Å—Ç–≤—É–≤–∞—â–æ—Ç–æ API
- üìà **Comprehensive –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–∞–Ω–∏ –æ—Ç—á–µ—Ç–∏

### **–ë–∏–∑–Ω–µ—Å —Å—Ç–æ–π–Ω–æ—Å—Ç:**
- **–ü–æ-—Ç–æ—á–Ω–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏** –∑–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –ª–∏–≥–∏
- **–ü–æ–¥–æ–±—Ä–µ–Ω–∞ user experience** —Å league-aware predictions
- **Scalable –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –∑–∞ –±—ä–¥–µ—â–æ —Ä–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ
- **Data-driven insights** –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ —Ñ—É—Ç–±–æ–ª–Ω–∏ –ø–∞–∑–∞—Ä–∏

---

*–ü—Ä–æ–µ–∫—Ç –∑–∞–≤—ä—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ –Ω–∞ 12 –Ω–æ–µ–º–≤—Ä–∏ 2025 –≥. üéâ*
