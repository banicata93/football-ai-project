# üèÜ League-Specific OU2.5 –ø–æ–¥-–º–æ–¥–µ–ª–∏ —Å –ø—Ä–æ–∑—Ä–∞—á–µ–Ω fallback

## ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω–∞!**

### üìä **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –Ω–∞ —Å–∏—Å—Ç–µ–º–∞—Ç–∞:**

## 1Ô∏è‚É£ **–ù–æ–≤–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞ –º–æ–¥–µ–ª–∏** ‚úÖ

```
models/
‚îú‚îÄ‚îÄ model_ou25_v1/                 # –≥–ª–æ–±–∞–ª–µ–Ω OU2.5 (–±–µ–∑ –ø—Ä–æ–º—è–Ω–∞)
‚îî‚îÄ‚îÄ leagues/
    ‚îú‚îÄ‚îÄ premier_league/ou25_v1/
    ‚îú‚îÄ‚îÄ la_liga/ou25_v1/
    ‚îú‚îÄ‚îÄ serie_a/ou25_v1/
    ‚îú‚îÄ‚îÄ bundesliga/ou25_v1/
    ‚îî‚îÄ‚îÄ ligue_1/ou25_v1/
```

**–í—ä–≤ –≤—Å—è–∫–∞ ou25_v1/ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:**
- `ou25_model.pkl` - LightGBM –º–æ–¥–µ–ª
- `feature_columns.json` - Feature —Å–ø–∏—Å—ä–∫ (–∏–¥–µ–Ω—Ç–∏—á–µ–Ω —Å –≥–ª–æ–±–∞–ª–Ω–∏—è)
- `metrics.json` - Accuracy, LogLoss, Brier, ROC-AUC
- `calibrator.pkl` - Isotonic calibrator (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–æ)

## 2Ô∏è‚É£ **Training pipeline —Å --per-league —Ñ–ª–∞–≥** ‚úÖ

**–ò–∑–ø–æ–ª–∑–≤–∞–Ω–µ:**
```bash
# –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Å–∏—á–∫–∏ –º–æ–¥–µ–ª–∏ + per-league OU2.5
python3 pipelines/train_ml_models.py --per-league

# –°–∞–º–æ per-league OU2.5 –º–æ–¥–µ–ª–∏
python3 pipelines/train_ml_models.py --only-per-league
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–§–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –ø–æ –ª–∏–≥–∞** —Å –º–∏–Ω–∏–º—É–º 2000 –º–∞—á–∞
- ‚úÖ **Feature consistency** - —Å—ä—â–∏—Ç–µ 64 features –∫–∞—Ç–æ –≥–ª–æ–±–∞–ª–Ω–∏—è –º–æ–¥–µ–ª
- ‚úÖ **Isotonic calibration** –∑–∞ –≤—Å—è–∫–∞ –ª–∏–≥–∞
- ‚úÖ **–•—Ä–æ–Ω–æ–ª–æ–≥–∏—á–Ω–æ —Ä–∞–∑–¥–µ–ª—è–Ω–µ** train/val –ø–æ –ª–∏–≥–∞
- ‚úÖ **Assert –ø—Ä–æ–≤–µ—Ä–∫–∞** –∑–∞ feature —Å—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç
- ‚úÖ **Summary –æ—Ç—á–µ—Ç** –≤ `logs/model_reports/ou25_per_league_summary.json`

## 3Ô∏è‚É£ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ –≤ API** ‚úÖ

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ `config/model_config.yaml`:**
```yaml
model_ou25:
  per_league:
    enabled: true
    min_matches_per_league: 2000
    target_leagues:
      - premier_league
      - la_liga
      - serie_a
      - bundesliga
      - ligue_1
    calibration_enabled: true
    lazy_loading: true
```

**API —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç–∏:**
- ‚úÖ **Lazy loading** - –º–æ–¥–µ–ª–∏ —Å–µ –∑–∞—Ä–µ–∂–¥–∞—Ç –ø—Ä–∏ –ø—ä—Ä–≤–æ –∑–∞–ø–∏—Ç–≤–∞–Ω–µ
- ‚úÖ **Feature consistency –ø—Ä–æ–≤–µ—Ä–∫–∞** –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ
- ‚úÖ **Memory caching** –Ω–∞ –∑–∞—Ä–µ–¥–µ–Ω–∏—Ç–µ –º–æ–¥–µ–ª–∏
- ‚úÖ **Graceful fallback** –∫—ä–º –≥–ª–æ–±–∞–ª–µ–Ω –º–æ–¥–µ–ª

## 4Ô∏è‚É£ **Inference –ª–æ–≥–∏–∫–∞ —Å fallback** ‚úÖ

**–õ–æ–≥–∏–∫–∞ –Ω–∞ –∏–∑–±–æ—Ä –Ω–∞ –º–æ–¥–µ–ª:**
1. **League mapping** - `"Premier League"` ‚Üí `"premier_league"`
2. **Per-league –º–æ–¥–µ–ª** - –∞–∫–æ —Å—ä—â–µ—Å—Ç–≤—É–≤–∞ –∏ –µ –∑–∞—Ä–µ–¥–µ–Ω
3. **–ö–∞–ª–∏–±—Ä–∞—Ü–∏—è** - –∞–∫–æ –µ –Ω–∞–ª–∏—á–Ω–∞ –∑–∞ –ª–∏–≥–∞—Ç–∞
4. **Fallback** - –∫—ä–º –≥–ª–æ–±–∞–ª–µ–Ω OU2.5 –º–æ–¥–µ–ª

**API Response –¥–æ–±–∞–≤–∫–∏:**
```json
{
  "prediction_ou25": { ... },
  "model_sources": {
    "ou25": "league_ou25"  // –∏–ª–∏ "global_ou25"
  }
}
```

## 5Ô∏è‚É£ **League utilities** ‚úÖ

**`core/league_utils.py` —Ñ—É–Ω–∫—Ü–∏–∏:**
- ‚úÖ `get_league_slug()` - League name ‚Üí slug mapping
- ‚úÖ `get_league_display_name()` - Slug ‚Üí display name
- ‚úÖ `is_supported_league()` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –ø–æ–¥–¥—Ä—ä–∂–∫–∞
- ‚úÖ `get_per_league_model_path()` - Path –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ
- ‚úÖ **10 –ø–æ–¥–¥—ä—Ä–∂–∞–Ω–∏ –ª–∏–≥–∏** —Å case-insensitive mapping

## 6Ô∏è‚É£ **Comprehensive —Ç–µ—Å—Ç–æ–≤–µ** ‚úÖ

**`tests/test_per_league_models.py`:**
- ‚úÖ **League mapping —Ç–µ—Å—Ç–æ–≤–µ**
- ‚úÖ **Model loading —Ç–µ—Å—Ç–æ–≤–µ**
- ‚úÖ **Feature consistency —Ç–µ—Å—Ç–æ–≤–µ**
- ‚úÖ **Fallback behavior —Ç–µ—Å—Ç–æ–≤–µ**
- ‚úÖ **Integration —Ç–µ—Å—Ç–æ–≤–µ**
- ‚úÖ **Training pipeline —Ç–µ—Å—Ç–æ–≤–µ**

---

## üöÄ **Deployment —Å—Ç–∞—Ç—É—Å:**

### ‚úÖ **–ê–∫—Ç–∏–≤–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:**

1. **API —Å—ä—Ä–≤—ä—Ä**: `http://localhost:3000` - **–†–ê–ë–û–¢–ò**
   - Per-league —Å–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞ ‚úÖ
   - Lazy loading –∑–∞ 5 –ª–∏–≥–∏ ‚úÖ
   - Fallback –∫—ä–º –≥–ª–æ–±–∞–ª–µ–Ω –º–æ–¥–µ–ª ‚úÖ

2. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: **–ì–û–¢–û–í–ê**
   - Enabled: `true`
   - Min matches: `2000`
   - Target leagues: `5` (Premier League, La Liga, Serie A, Bundesliga, Ligue 1)
   - Lazy loading: `true`
   - Calibration: `true`

3. **Training pipeline**: **–ì–û–¢–û–í**
   - `--per-league` —Ñ–ª–∞–≥ —Ä–∞–±–æ—Ç–∏
   - Feature consistency –ø—Ä–æ–≤–µ—Ä–∫–∏
   - Isotonic calibration –ø–æ–¥–¥—Ä—ä–∂–∫–∞

4. **–¢–µ—Å—Ç–æ–≤–µ**: **–ü–†–ï–ú–ò–ù–ê–í–ê–¢**
   - League mapping: ‚úÖ
   - Model loading: ‚úÖ
   - Fallback behavior: ‚úÖ

---

## üìä **–¢–µ–∫—É—â–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏:**

### **API —Ç–µ—Å—Ç–æ–≤–µ:**
```bash
curl -X POST http://localhost:3000/predict \
  -H "Content-Type: application/json" \
  -d '{"home_team": "Barcelona", "away_team": "Real Madrid", "league": "La Liga"}'
```

**–†–µ–∑—É–ª—Ç–∞—Ç:**
- ‚úÖ **OU2.5 prediction —Ä–∞–±–æ—Ç–∏**: Over 0.828 | Under 0.172
- ‚úÖ **Lazy loading –∞–∫—Ç–∏–≤–µ–Ω**: –û–ø–∏—Ç–≤–∞ —Å–µ –¥–∞ –∑–∞—Ä–µ–¥–∏ la_liga –º–æ–¥–µ–ª
- ‚úÖ **Fallback —Ä–∞–±–æ—Ç–∏**: –ò–∑–ø–æ–ª–∑–≤–∞ global_ou25 (–Ω—è–º–∞ —Ç—Ä–µ–Ω–∏—Ä–∞–Ω–∏ –º–æ–¥–µ–ª–∏)
- ‚úÖ **Confidence scoring**: 0.644 (entropy+agreement)

### **Per-league —Å–∏—Å—Ç–µ–º–∞:**
- üìÅ **Model —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: –°—ä–∑–¥–∞–¥–µ–Ω–∞ –∑–∞ 5 –ª–∏–≥–∏
- üîß **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ê–∫—Ç–∏–≤–Ω–∞ –∏ –≤–∞–ª–∏–¥–Ω–∞
- üß™ **–¢–µ—Å—Ç–æ–≤–µ**: –í—Å–∏—á–∫–∏ –ø—Ä–µ–º–∏–Ω–∞–≤–∞—Ç
- üìã **Training –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç**: 100%

---

## üéØ **–°–ª–µ–¥–≤–∞—â–∏ —Å—Ç—ä–ø–∫–∏ –∑–∞ production:**

### **1. –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞ per-league –º–æ–¥–µ–ª–∏:**
```bash
# –ê–∫–æ –∏–º–∞—Ç–µ –¥–æ—Å—Ç–∞—Ç—ä—á–Ω–æ –¥–∞–Ω–Ω–∏ (‚â•2000 –º–∞—á–∞ –Ω–∞ –ª–∏–≥–∞)
python3 pipelines/train_ml_models.py --per-league
```

### **2. –û—á–∞–∫–≤–∞–Ω–∏ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è:**
- **+2-4% accuracy** –Ω–∞ OU2.5 –≤ –ø–æ–∫—Ä–∏—Ç–∏—Ç–µ –ª–∏–≥–∏
- **‚Üì LogLoss/Brier** (–ø–æ-–¥–æ–±—Ä–∞ –∫–∞–ª–∏–±—Ä–∞—Ü–∏—è)
- **‚Üì Bias** –æ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∏—è –≥–ª–æ–±–∞–ª–µ–Ω –º–æ–¥–µ–ª
- **–ü—Ä–æ–∑—Ä–∞—á–µ–Ω fallback** –∫—ä–º –≥–ª–æ–±–∞–ª–µ–Ω –º–æ–¥–µ–ª

### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- **Model source tracking** –≤ prediction logs
- **Performance comparison** –º–µ–∂–¥—É league vs global –º–æ–¥–µ–ª–∏
- **Calibration monitoring** –∑–∞ –≤—Å—è–∫–∞ –ª–∏–≥–∞ –æ—Ç–¥–µ–ª–Ω–æ

---

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è:**

### **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (—Å–ø–∞–∑–µ–Ω–∏):**
- ‚úÖ **–ù—è–º–∞ –ø—Ä–æ–º—è–Ω–∞ –≤ JSON response —Å—Ö–µ–º–∞—Ç–∞** –Ω–∞ API
- ‚úÖ **–ù–µ —Å–µ –ø—Ä–æ–º–µ–Ω—è—Ç feature-–∏—Ç–µ** (64 features –∑–∞–ø–∞–∑–µ–Ω–∏)
- ‚úÖ **–ù—è–º–∞ –≥–ª–æ–±–∞–ª–Ω–∏ –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏** (–∏–∑–ø–æ–ª–∑–≤–∞ DI/ServiceManager)
- ‚úÖ **Backward compatibility** –∑–∞–ø–∞–∑–µ–Ω–∞

### **Performance & —Ä–µ—Å—É—Ä—Å–∏:**
- ‚úÖ **–ö–µ—à–∏—Ä–∞–Ω–∏ –º–æ–¥–µ–ª–∏** –≤ –ø–∞–º–µ—Ç
- ‚úÖ **Lazy loading** –ø—Ä–∏ –ø—ä—Ä–≤–æ –∑–∞–ø–∏—Ç–≤–∞–Ω–µ
- ‚úÖ **Graceful degradation** –ø—Ä–∏ –ª–∏–ø—Å–∞ –Ω–∞ –º–æ–¥–µ–ª–∏

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏:**
- ‚úÖ **–ú–∏–Ω–∏–º–∞–ª–Ω–∏ –º–∞—á–æ–≤–µ**: 2000 (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ)
- ‚úÖ **Target –ª–∏–≥–∏**: 5 (—Ä–∞–∑—à–∏—Ä—è–µ–º–æ)
- ‚úÖ **Calibration**: –í–∫–ª—é—á–µ–Ω–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª–Ω–∞)
- ‚úÖ **Lazy loading**: –í–∫–ª—é—á–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω)

---

## üéâ **–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:**

**League-Specific OU2.5 —Å–∏—Å—Ç–µ–º–∞—Ç–∞ –µ –Ω–∞–ø—ä–ª–Ω–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∑–∞ production!**

### **–ö–ª—é—á–æ–≤–∏ –ø–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–µ–Ω fallback** - –Ω–∏–∫–∞–∫–≤–∏ breaking changes
- ‚úÖ **Feature consistency** - –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞–Ω–∞ —Å—ä–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç
- ‚úÖ **Comprehensive —Ç–µ—Å—Ç–æ–≤–µ** - –≤—Å–∏—á–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∫—Ä–∏—Ç–∏
- ‚úÖ **Production ready** - lazy loading –∏ caching
- ‚úÖ **Extensible design** - –ª–µ—Å–Ω–æ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∏ –ª–∏–≥–∏

### **–ì–æ—Ç–æ–≤–∞ –∑–∞:**
- üöÄ **–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –Ω–∞ per-league –º–æ–¥–µ–ª–∏** —Å —Ä–µ–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏
- üìä **A/B —Ç–µ—Å—Ç–≤–∞–Ω–µ** —Å—Ä–µ—â—É –≥–ª–æ–±–∞–ª–Ω–∏—è –º–æ–¥–µ–ª
- üîç **Performance –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –ø–æ –ª–∏–≥–∏
- üìà **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞–∑—à–∏—Ä—è–≤–∞–Ω–µ** –∫—ä–º –¥—Ä—É–≥–∏ –ø–∞–∑–∞—Ä–∏ (BTTS, 1X2)

**üèÜ –°–∏—Å—Ç–µ–º–∞—Ç–∞ –æ—Å–∏–≥—É—Ä—è–≤–∞ –Ω–∞–π-–¥–æ–±—Ä–∞—Ç–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –æ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å—Ç–∞–±–∏–ª–Ω–æ—Å—Ç –≤ –∏–Ω–¥—É—Å—Ç—Ä–∏—è—Ç–∞!**
